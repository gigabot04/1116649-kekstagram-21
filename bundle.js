(()=>{"use strict";(()=>{let e;window.helpersModule={debounce:(t,o=500)=>{e&&window.clearTimeout(e),e=window.setTimeout(t,o)}}})(),(()=>{const e=document.querySelector(".pictures"),t=document.querySelectorAll(".img-filters__button"),o=document.querySelector("#filter-default"),n=document.querySelector("#filter-random"),r=document.querySelector("#filter-discussed"),c=e=>Math.floor(Math.random()*e.length),s=t=>{for(;document.querySelector(".picture");)document.querySelector(".picture").remove();const o=document.createDocumentFragment();t.forEach((e=>{o.appendChild(window.galleryModule.renderPhoto(e))})),e.appendChild(o)};let d=[];const l=e=>{if(o.classList.contains("img-filters__button--active"))s(e);else if(n.classList.contains("img-filters__button--active")){let t=[];for(;t.length<10;){const o=e[c(e)];t.includes(o)||t.push(o)}s(t)}else if(r.classList.contains("img-filters__button--active")){let e=[...d];e.sort(((e,t)=>t.comments.length-e.comments.length)),s(e)}};for(let e=0;e<t.length;e++)t[e].addEventListener("click",(()=>{document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),t[e].classList.add("img-filters__button--active"),window.helpersModule.debounce((()=>l(d)))}));window.filtersModule={filteredPictures:l,createPictures:s,successLoad:e=>{d=e,window.filtersModule.filteredPictures(d),document.querySelector(".img-filters").classList.remove("img-filters--inactive")}}})(),window.backend={load:(e,t)=>{const o=new XMLHttpRequest;o.responseType="json",o.open("GET","https://21.javascript.pages.academy/kekstagram/data"),o.addEventListener("load",(()=>{const n="";switch(o.status){case 200:e(o.response);break;case 400:n="Неверный запрос";break;case 401:n="Пользователь не авторизован";break;case 404:n="Ничего не найдено";break;default:n=`Cтатус ответа: : ${o.status} ${o.statusText}`}n&&t(n)})),o.addEventListener("error",(()=>{t("Произошла ошибка соединения")})),o.addEventListener("timeout",(()=>{t(`Запрос не успел выполниться за ${o.timeout} мс`)})),o.timeout=1e4,o.send()},upload:(e,t,o)=>{const n=new XMLHttpRequest;n.responseType="json",n.addEventListener("load",(()=>{t(n.response)})),n.addEventListener("error",(()=>{o()})),n.addEventListener("timeout",(()=>{o()})),n.timeout=1e4,n.open("POST","https://21.javascript.pages.academy/kekstagram/"),n.send(e)}},(()=>{const e=document.querySelector(".img-upload__preview img"),t=document.querySelector(".img-upload__overlay"),o=document.querySelector(".img-upload__cancel"),n=document.querySelector(".scale__control--smaller"),r=document.querySelector(".scale__control--bigger"),c=document.querySelector(".scale__control--value");let s,d=100;const l=e=>{"Escape"===e.key&&(e.preventDefault(),i())},i=()=>{t.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),document.removeEventListener("keydown",l),s&&(s.value="")};o.addEventListener("click",(()=>{i()})),n.addEventListener("click",(t=>{t.preventDefault(),d>25&&(d-=25,c.value=d+"%",e.style.transform=`scale(${d/100})`)})),r.addEventListener("click",(t=>{t.preventDefault(),d<100&&(d+=25,c.value=d+"%",e.style.transform=`scale(${d/100})`)})),window.pictureModule={uploadFile:o=>{if(s=o.target,t.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.addEventListener("keydown",l),window.formModule.init(e,l),s.files&&s.files[0]){const t=new FileReader;t.addEventListener("load",(t=>{e.setAttribute("src",t.target.result)})),t.readAsDataURL(s.files[0])}},photoEditClose:i,onPhotoEditEscPress:l}})(),(()=>{const e=document.querySelector(".big-picture__img").querySelector("img"),t=document.querySelector(".likes-count"),o=document.querySelector(".comments-count"),n=document.querySelector(".social__caption"),r=document.querySelector(".social__comments"),c=document.querySelector("#comment").content,s=document.querySelector(".big-picture"),d=document.querySelector(".big-picture__cancel"),l=e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const o=c.cloneNode(!0);o.querySelector(".social__picture").src=e.avatar,o.querySelector(".social__picture").alt=e.name,o.querySelector(".social__text").textContent=e.message,t.appendChild(o)})),t},i=e=>{"Escape"===e.key&&(e.preventDefault(),s.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"))},u=[],a=[],m=document.querySelector(".comments-loader"),p=document.querySelector(".social__comment-count"),v=()=>{s.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),document.removeEventListener("keydown",i),u.length=0,a.length=0,m.removeEventListener("click",y),d.removeEventListener("click",v)},y=()=>{r.appendChild(l(a.splice(0,5))),0===a.length&&(m.classList.add("hidden"),p.classList.add("hidden"))};window.previewModule={openPicture:c=>{for(u.push(...c.comments),a.push(...u.splice(5,u.length)),m.classList.remove("hidden"),p.classList.remove("hidden"),e.src=c.url,t.textContent=c.likes,o.textContent=c.comments.length,n.textContent=c.description,m.addEventListener("click",y);r.firstChild;)r.removeChild(r.firstChild);r.appendChild(l(u)),s.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.addEventListener("keydown",i),d.addEventListener("click",v)}}})(),(()=>{const e=document.querySelector(".text__description"),t=document.querySelectorAll(".effects__item"),o=document.querySelector(".img-upload__form"),n=document.querySelector(".effect-level__pin"),r=document.querySelector(".effect-level__value"),c=document.querySelector(".effect-level__depth"),s=/^#[a-zA-Zа-яА-ЯЁё0-9]*$/,d=document.querySelector(".img-upload__submit"),l=document.querySelector(".text__hashtags"),i={sepia:e=>`sepia(${e/100})`,chrome:e=>`grayscale(${e/100})`,marvin:e=>`invert(${e}%)`,phobos:e=>`blur(${3*e/100}px)`,heat:e=>`brightness(${2*e/100+1})`,none:()=>""},u=(e,t,o)=>o.indexOf(e)!==t;window.formModule={init:(a,m)=>{for(let e=0;e<t.length;e++)t[e].addEventListener("click",(()=>{const o=t[e].querySelector(".effects__preview").classList[1];a.className="",a.classList.add(o),a.style.filter="",n.style.left="100%",c.style.width="100%"}));const p=e=>{e.preventDefault();const t=document.querySelector(".effects__radio:checked").value;let o=e.clientX;const s=function(e){e.preventDefault();let s=o-e.clientX;o=e.clientX;let d=(n.offsetLeft-s)/4.53;n.style.left=d+"%",c.style.width=d+"%",a.style.filter=i[t](d),r.value=parseInt(d,10),n.offsetLeft<=0?(n.style.left="0%",c.style.width="0%"):n.offsetLeft>=453&&(n.style.left="100%",c.style.width="100%")},d=function(e){e.preventDefault(),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",d)};n.addEventListener("mousedown",p),e.addEventListener("focus",(()=>{document.removeEventListener("keydown",m)})),e.addEventListener("blur",(()=>{document.addEventListener("keydown",m)})),l.addEventListener("focus",(()=>{document.removeEventListener("keydown",m)})),l.addEventListener("blur",(()=>{document.addEventListener("keydown",m)})),d.addEventListener("click",(()=>{const e=l.value.split(" ");let t=!0;for(let n=0;n<e.length;n++)e[n]=e[n].toUpperCase(),""!==l.value&&(!("#"!==(o=e[n])&&s.test(o)&&o.length>2&&o.length<20)||e.some(u)||e.length>5)&&(t=!1);var o;t||(l.setCustomValidity("Есть неправильные или повторяющиеся хеш-теги"),l.reportValidity())}));const v=e=>{"Escape"===e.key&&(e.preventDefault(),document.querySelector(".error").remove())},y=e=>{"Escape"===e.key&&(e.preventDefault(),document.querySelector(".success").remove())},f=e=>{e.preventDefault(),n.removeEventListener("mousedown",p),document.removeEventListener("keydown",window.pictureModule.onPhotoEditEscPress),o.removeEventListener("submit",f),window.backend.upload(new FormData(o),(()=>{o.reset(),window.pictureModule.photoEditClose(),(()=>{const e=document.createDocumentFragment(),t=document.querySelector("#success").content.cloneNode(!0);e.appendChild(t),document.querySelector("main").appendChild(e),document.addEventListener("keydown",y),document.querySelector(".success__button").addEventListener("click",(()=>{document.removeEventListener("keydown",y),document.querySelector(".success").remove()}))})(),document.querySelector(".img-upload__preview img").removeAttribute("style",""),document.querySelector(".img-upload__preview img").removeAttribute("class","")}),(()=>{window.pictureModule.photoEditClose(),(()=>{const e=document.createDocumentFragment(),t=document.querySelector("#error").content.cloneNode(!0);e.appendChild(t),document.querySelector("main").appendChild(e),document.addEventListener("keydown",v),document.querySelector(".error__button").addEventListener("click",(()=>{document.removeEventListener("keydown",v),document.querySelector(".error").remove()}))})()}))};o.addEventListener("submit",f)},uploadError:e=>{const t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)}}})(),(()=>{const e=document.querySelector("#picture").content.querySelector(".picture");window.galleryModule={renderPhoto:t=>{const o=e.cloneNode(!0);return o.querySelector(".picture__img").src=t.url,o.querySelector(".picture__likes").textContent=t.likes,o.querySelector(".picture__comments").textContent=t.comments.length,o.addEventListener("click",(()=>{window.previewModule.openPicture(t)})),o}}})(),(()=>{const e=document.querySelector("#upload-file");window.backend.load(window.filtersModule.successLoad,window.formModule.uploadError),e.addEventListener("change",window.pictureModule.uploadFile)})()})();